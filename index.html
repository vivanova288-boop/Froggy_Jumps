<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: sans-serif; }
        #bg { position: fixed; inset: 0; background-size: cover; background-position: center; z-index: -1; }
        #ui { position: absolute; top: 0; width: 100%; text-align: center; color: white; }
        #header { background: #6ab04c; padding: 10px; font-weight: bold; }
        #q-box { background: white; color: #333; width: 80%; max-width: 500px; margin: 15px auto; padding: 15px; border-radius: 15px; }
        .lives { position: absolute; top: 55px; left: 15px; display: flex; gap: 5px; }
        .heart { width: 30px; height: 30px; background-size: contain; background-repeat: no-repeat; }
        #frog { position: absolute; width: 80px; height: 80px; background-size: contain; background-repeat: no-repeat; transition: 0.5s; transform: translate(-50%, -65%); z-index: 100; opacity: 0; }
        .leaf { position: absolute; width: 120px; height: 100px; background-size: contain; background-repeat: no-repeat; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer; }
        .shock { animation: shock 0.1s infinite; }
        @keyframes shock { 0% { filter: brightness(3) hue-rotate(90deg); } 100% { filter: brightness(1); } }
        #start, #end { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 2000; }
        button { background: #6ab04c; color: white; border: none; padding: 15px 30px; border-radius: 20px; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="bg"></div>
    <div id="start"><h1>FROGGY QUEST</h1><button onclick="begin()">ИГРАТЬ</button></div>
    <div id="ui">
        <div id="header"></div>
        <div class="lives" id="hp"></div>
        <div id="q-box">...</div>
    </div>
    <div id="frog"></div>
    <div id="pond"></div>
    <div id="end" style="display:none"><h1 id="msg"></h1><button onclick="location.reload()">ЗАНОВО</button></div>

<script>
    let c = {}, step = 0, lives = 5;

    function init() {
        const d = new URLSearchParams(window.location.search).get('d');
        if(!d) return;
        c = JSON.parse(decodeURIComponent(atob(d)));
        document.getElementById('bg').style.backgroundImage = `url(${c.v[0]})`;
        document.getElementById('frog').style.backgroundImage = `url(${c.v[1]})`;
        document.getElementById('header').innerText = c.t;
    }

    function begin() {
        document.getElementById('start').style.display = 'none';
        document.getElementById('frog').style.opacity = 1;
        snd(0);
        render();
    }

    function render() {
        if(step >= c.q.length) return finish("ПОБЕДА!", 3);
        const q = c.q[step];
        document.getElementById('q-box').innerText = q[0];
        updateHp();
        const pond = document.getElementById('pond');
        pond.innerHTML = '';
        let opts = [ {t:q[1], c:true}, {t:q[2], c:false}, {t:q[3], c:false} ].sort(() => Math.random() - 0.5);
        opts.forEach((o, i) => {
            const l = document.createElement('div');
            l.className = 'leaf';
            l.style.backgroundImage = `url(${c.v[2]})`;
            l.style.left = (15 + i*35) + "%"; l.style.top = "60%";
            l.innerText = o.t;
            l.onclick = () => {
                if(o.c) { snd(1); move(l); step++; setTimeout(render, 600); }
                else { lives--; updateHp(); snd(2); shock(); if(lives <= 0) finish("ИГРА ОКОНЧЕНА", 4); }
            };
            pond.appendChild(l);
            if(step === 0 && i === 1) move(l);
        });
    }

    function move(el) {
        const f = document.getElementById('frog');
        f.style.left = (el.offsetLeft + el.offsetWidth/2) + "px";
        f.style.top = (el.offsetTop + el.offsetHeight/2) + "px";
    }

    function updateHp() {
        const h = document.getElementById('hp'); h.innerHTML = '';
        for(let i=0; i<lives; i++) {
            const i = document.createElement('div'); i.className = 'heart';
            i.style.backgroundImage = `url(${c.v[3]})`; h.appendChild(i);
        }
    }

    function snd(i) { new Audio(c.s[i]).play().catch(()=>{}); }
    function shock() { 
        document.getElementById('frog').classList.add('shock'); 
        setTimeout(() => document.getElementById('frog').classList.remove('shock'), 500); 
    }
    function finish(t, s) {
        document.getElementById('end').style.display = 'flex';
        document.getElementById('msg').innerText = t;
        snd(s);
    }
    init();
</script>
</body>
</html>
