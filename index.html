<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; font-family:sans-serif; background:#000; }
        #gm { width:100%; height:100%; position:relative; background-size:cover; background-position:center; display:none; }
        #top-bar { position:absolute; top:0; width:100%; height:40px; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; color:#fff; z-index:10; }
        #ui { position:absolute; top:50px; width:100%; display:flex; justify-content:space-between; padding:0 20px; box-sizing:border-box; z-index:10; width:100%; }
        #q-card { background:#fff; border-radius:30px; padding:15px; box-shadow:0 4px 15px rgba(0,0,0,0.4); text-align:center; width:50%; min-height:60px; }
        #tm-bg { width:100%; height:8px; background:#ddd; border-radius:4px; margin-top:10px; overflow:hidden; }
        #tm-f { height:100%; width:100%; background:#ff4757; transition:linear; }
        #lives { display:flex; gap:5px; align-items:center; }
        .h { width:30px; height:30px; background-size:contain; background-repeat:no-repeat; }
        #frog { width:100px; height:100px; position:absolute; z-index:100; transition:0.6s cubic-bezier(.47,1.21,.58,1); background-size:contain; background-repeat:no-repeat; }
        
        .leaf-wrap { position:absolute; width:140px; text-align:center; cursor:pointer; z-index:5; }
        .leaf-img { width:130px; height:90px; background-size:contain; background-repeat:no-repeat; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; text-shadow:1px 1px 3px #000; padding:10px; box-sizing:border-box; }
        .letter { background:#f1c40f; width:24px; height:24px; border-radius:50%; margin:0 auto -12px; position:relative; z-index:6; font-size:14px; font-weight:bold; display:flex; align-items:center; justify-content:center; border:2px solid #fff; color:#000; }
        
        #vol-box { background:#fff; padding:10px; border-radius:20px; display:flex; align-items:center; gap:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); }
        .shock { animation: sh 0.1s infinite; filter: brightness(2) contrast(2) hue-rotate(180deg); }
        @keyframes sh { 0% { transform:translate(2px); } 50% { transform:translate(-2px); } }
    </style>
</head>
<body>
    <div id="gm">
        <div id="top-bar"></div>
        <div id="ui">
            <div id="lives"></div>
            <div id="q-card">
                <div id="q-txt" style="font-weight:bold; font-size:18px; color:#333;"></div>
                <div id="tm-bg"><div id="tm-f"></div></div>
            </div>
            <div id="vol-box">
                üîä <input type="range" id="vol" min="0" max="1" step="0.1" value="0.5" style="width:60px;">
            </div>
        </div>
        <div id="pond"></div>
        <div id="frog"></div>
    </div>

<script>
    let c, step=0, hp, lastP={x:50,y:85}, aud={}, tmr;
    const urlP = new URLSearchParams(window.location.search);
    const d = urlP.get('d');

    if(d) { try { c = JSON.parse(decodeURIComponent(d)); if(c.sh) shuffle(c.qs); init(); } catch(e) { console.error(e); } }

    function shuffle(a) { for(let i=a.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [a[i], a[j]] = [a[j], a[i]]; } }
    function play(i) { if(aud[i]) { aud[i].currentTime=0; aud[i].play(); } }

    function init(){
        const g=document.getElementById('gm'); g.style.display='block';
        g.style.backgroundImage=`url(${c.bg})`;
        document.getElementById('frog').style.backgroundImage=`url(${c.fr})`;
        c.s.forEach((u,i)=> { if(u) { aud[i]=new Audio(u); aud[i].volume=c.vol; } });
        document.getElementById('vol').oninput = (e) => {
            const v = e.target.value;
            Object.values(aud).forEach(a=>a.volume=v);
        };
        hp=c.li; drawHp(); move(50,85); play(0); load();
    }

    function drawHp(){
        const b=document.getElementById('lives'); b.innerHTML='';
        for(let i=0; i<hp; i++) b.innerHTML+=`<div class="h" style="background-image:url(${c.ic})"></div>`;
    }

    function load(){
        if(step >= c.qs.length) { play(3); alert(c.win); return; }
        clearInterval(tmr);
        const q=c.qs[step];
        document.getElementById('top-bar').innerText = `${c.t} | LEVEL ${Math.floor(step/c.qp)+1}`;
        document.getElementById('q-txt').innerText = q.q;
        
        const pond=document.getElementById('pond'); pond.innerHTML='';
        
        // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –æ—Ç–≤–µ—Ç–æ–≤, –≥–¥–µ –ø–µ—Ä–≤—ã–π ‚Äî –≤—Å–µ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
        let options = q.o.map((t, i) => ({t, isCorrect: i===0}));
        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∏—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        shuffle(options);

        options.forEach((opt, i)=>{
            const w=document.createElement('div'); w.className='leaf-wrap';
            // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã X: 20%, 50%, 80%
            const x = 20 + i*30; 
            // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y: —á—É—Ç—å –Ω–∏–∂–µ —Ü–µ–Ω—Ç—Ä–∞
            const y = 65; 
            w.style.left=x+'%'; w.style.top=y+'%';
            w.innerHTML = `<div class="letter">${String.fromCharCode(65+i)}</div><div class="leaf-img" style="background-image:url(${c.le})">${opt.t}</div>`;
            w.onclick=()=>jump(opt.isCorrect, x, y);
            pond.appendChild(w);
        });
        if(c.tme) startTmr();
    }

    function jump(isCorrect, x, y){
        move(x, y);
        if(isCorrect){ 
            play(1); 
            // –õ—è–≥—É—à–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ –Ω–∞ –ø–æ–ª—Å–µ–∫—É–Ω–¥—ã, –ø–æ—Ç–æ–º —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
            step++; setTimeout(load, 800); 
        } else {
            play(2); 
            const f=document.getElementById('frog'); 
            f.classList.add('shock'); // –®–æ–∫ –ø—Ä–∏ –Ω–µ–≤–µ—Ä–Ω–æ–º –æ—Ç–≤–µ—Ç–µ [cite: 2026-01-18]
            hp--; drawHp();
            setTimeout(()=>{
                f.classList.remove('shock'); 
                move(50, 85); // –û—Ç—Å–∫–∞–∫–∏–≤–∞–µ—Ç –≤ –Ω–∞—á–∞–ª–æ (–≤ –Ω–∏–∂–Ω—é—é —á–∞—Å—Ç—å –ø—Ä—É–¥–∞) [cite: 2026-01-18]
                if(hp<=0) { play(4); alert(c.lose); location.reload(); }
            }, 800);
        }
    }

    function startTmr(){
        let w=100; const f=document.getElementById('tm-f');
        tmr=setInterval(()=>{
            w-=100/(c.tm*10); f.style.width=w+'%';
            if(w<20) play(6);
            if(w<=0){ clearInterval(tmr); play(4); alert(c.lose); location.reload(); }
        }, 100);
    }

    function move(x,y){
        const f=document.getElementById('frog');
        f.style.left=`calc(${x}% - 50px)`; f.style.top=`calc(${y}% - 50px)`;
    }
</script>
</body>
</html>
