<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Froggy Quest Game</title>
<style>
    :root { --ui-bg: #6ab04c; }
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: Arial, sans-serif; background-color: #000; }
    
    /* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ñ–æ–Ω —á–µ—Ä–µ–∑ JS */
    #bg-layer {
        position: fixed; inset: 0;
        background-size: cover; background-position: center;
        z-index: -1;
    }

    #ui-layer { position: absolute; top: 0; width: 100%; z-index: 1000; pointer-events: none; }
    #header { background: var(--ui-bg); color: white; padding: 10px; text-align: center; font-weight: bold; pointer-events: auto; text-transform: uppercase; }
    #lives-container { position: absolute; top: 50px; left: 20px; display: flex; gap: 8px; pointer-events: auto; }
    .life-icon { width: 40px; height: 40px; background-size: contain; background-repeat: no-repeat; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }

    #question-box { background: white; width: 85%; max-width: 500px; margin: 10px auto; padding: 12px; border-radius: 18px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.25); pointer-events: auto; }
    .timer-bar { width: 100%; height: 8px; background: #dfe6e9; border-radius: 5px; margin-top: 8px; overflow: hidden; }
    #timer-fill { width: 100%; height: 100%; background: #eb4d4b; }

    #world { position: absolute; inset: 0; padding-top: 150px; }
    #pond { position: relative; width: 100%; height: 100%; }

    .leaf {
        position: absolute; width: 100px; height: 80px;
        background-size: contain; background-repeat: no-repeat; background-position: center;
        display: flex; align-items: center; justify-content: center;
        color: white; font-weight: bold; font-size: 18px; text-shadow: 1px 1px 2px black;
        cursor: pointer; transition: transform 0.3s;
    }
    .leaf:hover { transform: scale(1.1); }

    #frog {
        position: absolute; width: 70px; height: 70px;
        background-size: contain; background-repeat: no-repeat;
        z-index: 100; transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        pointer-events: none; transform: translate(-50%, -50%);
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è —à–æ–∫–∞ */
    .shock { animation: shock-ani 0.1s infinite; }
    @keyframes shock-ani { 0% { left: -2px; } 100% { left: 2px; } }

    #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; flex-direction: column; justify-content: center; align-items: center; color: white; }
    #countdown-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 3000; display: none; justify-content: center; align-items: center; font-size: 120px; color: white; font-weight: bold; }
    
    #volume-control { position: absolute; top: 50px; right: 20px; background: white; padding: 5px 10px; border-radius: 20px; display: flex; align-items: center; gap: 5px; pointer-events: auto; z-index: 2000; }
</style>
</head>
<body>

<div id="bg-layer"></div>
<div id="countdown-overlay">3</div>

<div id="ui-layer">
    <div id="header">FROGGY QUEST</div>
    <div id="lives-container"></div>
    <div id="question-box">
        <div id="q-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="timer-bar"><div id="timer-fill"></div></div>
    </div>
</div>

<div id="volume-control">
    üîä <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.5">
</div>

<div id="world">
    <div id="pond"><div id="frog"></div></div>
</div>

<div id="overlay">
    <h1 id="msg">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h1>
    <button onclick="location.reload()" style="padding: 15px 30px; border-radius: 20px; border: none; background: #6ab04c; color: white; cursor: pointer;">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
</div>

<script>
let cfg = {
    t: "FROGGY QUEST", li: 5, tm: 15, tme: true,
    bg: "", fr: "", le: "", ic: "", vol: 0.5,
    s: [], qs: []
};

let currentQ = 0;
let lives = 5;
let timerInt;

// 1. –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–• –ò–ó URL
function init() {
    const urlParams = new URLSearchParams(window.location.search);
    const data = urlParams.get('d');
    if (data) {
        try {
            cfg = JSON.parse(decodeURIComponent(data));
        } catch(e) { console.error("Data error", e); }
    }
    applyConfig();
    startCountdown();
}

// 2. –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ö–û–ù–§–ò–ì–ê
function applyConfig() {
    document.getElementById('header').innerText = cfg.t;
    document.getElementById('bg-layer').style.backgroundImage = `url(${cfg.bg})`;
    document.getElementById('frog').style.backgroundImage = `url(${cfg.fr})`;
    document.title = cfg.t;
    lives = cfg.li;
    document.getElementById('volume-slider').value = cfg.vol;
    updateLives();
}

function updateLives() {
    const cont = document.getElementById('lives-container');
    cont.innerHTML = '';
    for(let i=0; i<lives; i++) {
        const div = document.createElement('div');
        div.className = 'life-icon';
        div.style.backgroundImage = `url(${cfg.ic})`;
        cont.appendChild(div);
    }
}

// 3. –õ–û–ì–ò–ö–ê –ò–ì–†–´
function startCountdown() {
    const over = document.getElementById('countdown-overlay');
    over.style.display = 'flex';
    let count = 3;
    playSound(0); // –ó–≤—É–∫ —Å—Ç–∞—Ä—Ç–∞
    
    let itv = setInterval(() => {
        count--;
        if(count > 0) over.innerText = count;
        else if(count === 0) over.innerText = "GO!";
        else {
            clearInterval(itv);
            over.style.display = 'none';
            renderQuestion();
        }
    }, 1000);
}

function renderQuestion() {
    if(currentQ >= cfg.qs.length) {
        endGame("–ü–û–ë–ï–î–ê!");
        playSound(3); // –ó–≤—É–∫ –ø–æ–±–µ–¥—ã
        return;
    }

    const q = cfg.qs[currentQ];
    document.getElementById('q-text').innerText = q.q;
    
    // –°–æ–∑–¥–∞–µ–º –ª–∏—Å—Ç—å—è
    const pond = document.getElementById('pond');
    // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ª–∏—Å—Ç—å—è (–∫—Ä–æ–º–µ –ª—è–≥—É—à–∫–∏)
    const oldLeaves = pond.querySelectorAll('.leaf');
    oldLeaves.forEach(l => l.remove());

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã
    let options = q.o.map((text, idx) => ({ text, isCorrect: idx === 0 }));
    options = options.filter(o => o.text !== "").sort(() => Math.random() - 0.5);

    options.forEach((opt, i) => {
        const leaf = document.createElement('div');
        leaf.className = 'leaf';
        leaf.style.backgroundImage = `url(${cfg.le})`;
        leaf.innerText = opt.text;
        leaf.style.left = (20 + i * 30) + "%";
        leaf.style.top = "50%";
        
        leaf.onclick = () => handleAnswer(opt.isCorrect, leaf);
        pond.appendChild(leaf);
        
        // –í —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ —Å—Ç–∞–≤–∏–º –ª—è–≥—É—à–∫—É –Ω–∞ –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç–∏–∫ (–≤–∏–∑—É–∞–ª—å–Ω–æ)
        if(currentQ === 0 && i === 0) {
            moveFrog(leaf.offsetLeft + 50, leaf.offsetTop + 40);
        }
    });

    startTimer();
}

function handleAnswer(correct, el) {
    if(correct) {
        playSound(1); // –í–µ—Ä–Ω–æ
        moveFrog(el.offsetLeft + 50, el.offsetTop + 40);
        currentQ++;
        setTimeout(renderQuestion, 600);
    } else {
        lives--;
        updateLives();
        playSound(2); // –û—à–∏–±–∫–∞
        
        const frogEl = document.getElementById('frog');
        frogEl.classList.add('shock');
        setTimeout(() => frogEl.classList.remove('shock'), 500);

        if(lives <= 0) endGame("–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê");
    }
}

function moveFrog(x, y) {
    const f = document.getElementById('frog');
    f.style.left = x + "px";
    f.style.top = y + "px";
}

function startTimer() {
    clearInterval(timerInt);
    if(!cfg.tme) return;
    let time = 100;
    timerInt = setInterval(() => {
        time -= (100 / (cfg.tm * 10));
        document.getElementById('timer-fill').style.width = time + "%";
        if(time <= 0) {
            clearInterval(timerInt);
            lives--;
            updateLives();
            if(lives > 0) renderQuestion();
            else endGame("–í–†–ï–ú–Ø –í–´–®–õ–û");
        }
    }, 100);
}

function playSound(idx) {
    if(cfg.s[idx]) {
        const a = new Audio(cfg.s[idx]);
        a.volume = document.getElementById('volume-slider').value;
        a.play().catch(e => {});
    }
}

function endGame(m) {
    clearInterval(timerInt);
    document.getElementById('msg').innerText = m;
    document.getElementById('overlay').style.display = 'flex';
}

window.onload = init;
</script>
</body>
</html>
