<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; font-family:sans-serif; background:#000; }
        #gm { width:100%; height:100%; position:relative; background-size:cover; background-position:center; display:none; }
        
        /* –ó–∞—Å—Ç–∞–≤–∫–∞ */
        #splash { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; display:flex; align-items:center; justify-content:center; color:#fff; font-size:120px; font-weight:bold; }
        
        #top-bar { position:absolute; top:0; width:100%; height:40px; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; color:#fff; z-index:10; }
        #ui { position:absolute; top:50px; width:100%; display:flex; justify-content:space-between; padding:0 20px; box-sizing:border-box; z-index:10; }
        #q-card { background:#fff; border-radius:20px; padding:15px; box-shadow:0 4px 15px rgba(0,0,0,0.3); text-align:center; width:50%; }
        #tm-bg { width:100%; height:6px; background:#ddd; border-radius:3px; margin-top:8px; overflow:hidden; }
        #tm-f { height:100%; width:100%; background:#ff4757; transition:linear; }
        
        .h { width:30px; height:30px; background-size:contain; background-repeat:no-repeat; display:inline-block; }
        #frog { width:80px; height:80px; position:absolute; z-index:100; transition:0.6s cubic-bezier(.47,1.21,.58,1); background-size:contain; background-repeat:no-repeat; }
        
        .leaf-wrap { position:absolute; width:120px; text-align:center; transition:0.3s; opacity: 0.4; }
        .leaf-wrap.active { opacity: 1; cursor:pointer; }
        .leaf-img { width:100%; height:80px; background-size:contain; background-repeat:no-repeat; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; text-shadow:1px 1px 2px #000; }
        .letter { background:#f1c40f; width:20px; height:20px; border-radius:50%; margin:0 auto -10px; position:relative; z-index:2; font-size:12px; font-weight:bold; display:flex; align-items:center; justify-content:center; border:2px solid #fff; color:#000; }
        
        .shock { animation: sh 0.1s infinite; filter: brightness(2) contrast(2) hue-rotate(180deg); }
        @keyframes sh { 0% { transform:translate(2px); } 50% { transform:translate(-2px); } }
    </style>
</head>
<body>
    <div id="splash">3</div>
    <div id="gm">
        <div id="top-bar"></div>
        <div id="ui">
            <div id="lives"></div>
            <div id="q-card">
                <div id="q-txt" style="font-weight:bold;">–ü–û–î–ì–û–¢–û–í–ö–ê...</div>
                <div id="tm-bg"><div id="tm-f"></div></div>
            </div>
            <div id="vol-box" style="background:#fff; padding:5px; border-radius:10px;">
                üîà<input type="range" id="vol" min="0" max="1" step="0.1" value="0.5">
            </div>
        </div>
        <div id="pond"></div>
        <div id="frog"></div>
    </div>

<script>
    let c, step=0, hp, lastP={x:50,y:85}, aud={}, tmr;
    const urlP = new URLSearchParams(window.location.search);
    const d = urlP.get('d');

    if(d) { try { c = JSON.parse(decodeURIComponent(d)); init(); } catch(e) { console.error(e); } }

    function shuffle(a) { for(let i=a.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [a[i], a[j]] = [a[j], a[i]]; } }
    function playS(i) { if(aud[i]) { aud[i].currentTime=0; aud[i].play(); } }

    function init(){
        const g=document.getElementById('gm');
        g.style.backgroundImage=`url(${c.bg})`;
        document.getElementById('frog').style.backgroundImage=`url(${c.fr})`;
        c.s.forEach((u,i)=> { if(u) { aud[i]=new Audio(u); aud[i].volume=c.vol; } });
        
        // –°—Ç–∞—Ä—Ç –∑–∞—Å—Ç–∞–≤–∫–∏
        let count = 3;
        const s = document.getElementById('splash');
        let si = setInterval(() => {
            count--;
            if(count > 0) s.innerText = count;
            else {
                clearInterval(si);
                s.style.display = 'none';
                g.style.display = 'block';
                playS(0); // –ó–≤—É–∫ —Å—Ç–∞—Ä—Ç–∞
                hp=c.li; drawHp(); move(50,85); load();
            }
        }, 1000);
    }

    function drawHp(){
        const b=document.getElementById('lives'); b.innerHTML='';
        for(let i=0; i<hp; i++) b.innerHTML+=`<div class="h" style="background-image:url(${c.ic})"></div>`;
    }

    function load(){
        if(step >= c.qs.length) { playS(3); alert(c.win); return; }
        clearInterval(tmr);
        const q=c.qs[step];
        const level = Math.floor(step / c.qp);
        document.getElementById('top-bar').innerText = `${c.t} | –£–†–û–í–ï–ù–¨ ${level + 1}`;
        document.getElementById('q-txt').innerText = q.q;
        
        const pond=document.getElementById('pond'); pond.innerHTML='';
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ 5 —Ä—è–¥–æ–≤ (—Å–µ—Ç–∫–∞ –æ–∑–µ—Ä–∞)
        for(let r=0; r<c.qp; r++) {
            let isCurrentRow = r === (step % c.qp);
            let opts = isCurrentRow ? q.o.map((t, i) => ({t, ok: i===0})) : [{t:''},{t:''},{t:''}];
            if(isCurrentRow) shuffle(opts);

            opts.forEach((opt, i) => {
                const w=document.createElement('div');
                w.className = 'leaf-wrap' + (isCurrentRow ? ' active' : '');
                const x = 20 + i*30;
                const y = 75 - r*12; 
                w.style.left=x+'%'; w.style.top=y+'%';
                w.innerHTML = `<div class="letter">${String.fromCharCode(65+i)}</div><div class="leaf-img" style="background-image:url(${c.le})">${opt.t}</div>`;
                if(isCurrentRow) w.onclick = () => jump(opt.ok, x, y);
                pond.appendChild(w);
            });
        }
        if(c.tme) startTmr();
    }

    function jump(ok, x, y){
        move(x, y);
        if(ok){ 
            playS(1); lastP={x,y}; step++; 
            if(step % c.qp === 0) playS(5); // –ó–≤—É–∫ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
            setTimeout(load, 600); 
        } else {
            playS(2); 
            const f=document.getElementById('frog'); f.classList.add('shock'); 
            hp--; drawHp();
            setTimeout(()=>{
                f.classList.remove('shock'); 
                move(lastP.x, lastP.y); // –í–æ–∑–≤—Ä–∞—Ç [cite: 2026-01-18]
                if(hp<=0) { playS(4); alert(c.lose); location.reload(); }
            }, 800);
        }
    }

    function startTmr(){
        let w=100; const f=document.getElementById('tm-f');
        tmr=setInterval(()=>{
            w-=100/(c.tm*10); f.style.width=w+'%';
            if(w < 20) playS(6); 
            if(w<=0){ clearInterval(tmr); playS(4); alert(c.lose); location.reload(); }
        }, 100);
    }

    function move(x,y){
        const f=document.getElementById('frog');
        f.style.left=`calc(${x}% - 40px)`; f.style.top=`calc(${y}% - 40px)`;
    }
</script>
</body>
</html>
