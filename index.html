<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Froggy Quest</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #87CEEB; }
        #game-container { width: 100vw; height: 100vh; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* Шапка игры */
        #header { position: absolute; top: 0; width: 100%; height: 50px; background: #6ab04c; color: white; display: flex; align-items: center; justify-content: space-around; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 10; }
        
        /* Игровое поле */
        #world { width: 100%; height: 100%; position: relative; background: linear-gradient(#87CEEB, #E0F7FA); overflow: hidden; }
        
        /* Лягушка */
        #frog { width: 80px; height: 80px; position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); z-index: 5; transition: all 0.6s cubic-bezier(0.42, 0, 0.58, 1); filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3)); }
        
        /* Эффект тока (шок) */
        .shock { animation: shake 0.1s infinite; filter: sepia(1) saturate(10) hue-rotate(180deg) !important; }
        @keyframes shake { 0% { margin-left: 0; } 25% { margin-left: 5px; } 50% { margin-left: 0; } 75% { margin-left: -5px; } 100% { margin-left: 0; } }

        /* Лилия */
        .lily { width: 120px; height: 40px; background: url('https://i.postimg.cc/9M9Ym9m9/lily.png') no-repeat center/contain; position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); text-align: center; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .lily:hover { transform: translateX(-50%) scale(1.1); }
        .answer-text { position: absolute; top: -30px; width: 100%; text-align: center; color: #2d3436; font-size: 18px; font-weight: bold; text-shadow: 1px 1px 0 white; }

        /* Вопрос */
        #question-box { position: absolute; top: 100px; width: 80%; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; font-size: 24px; font-weight: bold; color: #2d3436; z-index: 8; }

        /* Окно загрузки */
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .btn-start { padding: 15px 40px; background: #6ab04c; color: white; border: none; border-radius: 30px; font-size: 20px; cursor: pointer; display: none; }
    </style>
</head>
<body>

<div id="loader">
    <h2 id="load-status">Ожидание настроек...</h2>
    <button id="start-btn" class="btn-start" onclick="startGame()">ИГРАТЬ!</button>
</div>

<div id="game-container">
    <div id="header">
        <div id="game-title">FROGGY QUEST</div>
        <div>Жизни: <span id="lives">5</span></div>
        <div>Таймер: <span id="timer">15</span></div>
    </div>
    
    <div id="world">
        <div id="question-box">Загрузка вопроса...</div>
        <img id="frog" src="https://i.postimg.cc/q7697m4n/frog.png" alt="frog">
        <div id="answers-zone"></div>
    </div>
</div>

<script>
    let config = null;
    let currentQ = 0;
    let lives = 5;
    let timeLeft = 15;
    let timerId = null;

    // СЛУШАЕМ РЕДАКТОР
    window.addEventListener('message', function(event) {
        if (event.data.type === 'config') {
            config = event.data.s;
            applyConfig();
        }
    });

    function applyConfig() {
        document.getElementById('load-status').innerText = "Готово!";
        document.getElementById('start-btn').style.display = "block";
        document.getElementById('game-title').innerText = config.t;
        document.getElementById('header').style.backgroundColor = config.clr;
        lives = config.li || 5;
        document.getElementById('lives').innerText = lives;
    }

    function startGame() {
        document.getElementById('loader').style.display = "none";
        showQuestion();
    }

    function showQuestion() {
        if (currentQ >= config.q.length) {
            alert("ПОБЕДА!");
            location.reload();
            return;
        }

        const qData = config.q[currentQ];
        document.getElementById('question-box').innerText = qData.q;
        
        const zone = document.getElementById('answers-zone');
        zone.innerHTML = "";
        
        // Перемешиваем ответы
        const answers = [...qData.a].map((text, index) => ({ text, isCorrect: index === 0 }));
        answers.sort(() => Math.random() - 0.5);

        answers.forEach((ans, i) => {
            const lily = document.createElement('div');
            lily.className = 'lily';
            lily.style.left = (20 + i * 30) + "%"; // Раставляем в ряд
            lily.innerHTML = `<div class="answer-text">${ans.text}</div>`;
            lily.onclick = () => checkAnswer(ans.isCorrect, lily);
            zone.appendChild(lily);
        });

        startTimer();
    }

    function checkAnswer(isCorrect, element) {
        const frog = document.getElementById('frog');
        const rect = element.getBoundingClientRect();
        const world = document.getElementById('world').getBoundingClientRect();
        
        // Прыжок
        frog.style.left = (rect.left - world.left + rect.width/2) + "px";
        frog.style.bottom = "120px";

        if (isCorrect) {
            clearInterval(timerId);
            setTimeout(() => {
                currentQ++;
                frog.style.bottom = "50px";
                frog.style.left = "50%";
                showQuestion();
            }, 800);
        } else {
            // МЕХАНИКА ШОКА (из твоих пожеланий)
            setTimeout(() => {
                frog.classList.add('shock');
                lives--;
                document.getElementById('lives').innerText = lives;
                
                setTimeout(() => {
                    frog.classList.remove('shock');
                    frog.style.bottom = "50px";
                    frog.style.left = "50%";
                    if (lives <= 0) {
                        alert("ИГРА ОКОНЧЕНА");
                        location.reload();
                    }
                }, 500);
            }, 400);
        }
    }

    function startTimer() {
        clearInterval(timerId);
        timeLeft = config.tm || 15;
        document.getElementById('timer').innerText = timeLeft;
        timerId = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(timerId);
                checkAnswer(false, { getBoundingClientRect: () => ({left: 0, width: 0}) });
            }
        }, 1000);
    }
</script>
</body>
</html>
