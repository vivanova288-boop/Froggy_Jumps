<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Froggy Quest</title>
<style>
    :root { --ui-bg: #6ab04c; }
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: Arial, sans-serif; background: #000; }
    
    /* –§–û–ù –¢–ï–ü–ï–†–¨ –ë–£–î–ï–¢ –í–ò–î–ï–ù */
    #game-bg {
        position: fixed; inset: 0;
        background-size: cover; background-position: center;
        z-index: -1;
    }

    #ui-layer { position: absolute; top: 0; width: 100%; z-index: 1000; pointer-events: none; }
    #header { background: var(--ui-bg); color: white; padding: 10px; text-align: center; font-weight: bold; pointer-events: auto; }
    
    #lives-container { position: absolute; top: 50px; left: 20px; display: flex; gap: 5px; pointer-events: auto; }
    .life-icon { width: 35px; height: 35px; background-size: contain; background-repeat: no-repeat; }

    #question-box { 
        background: white; width: 80%; max-width: 500px; margin: 15px auto; padding: 15px; 
        border-radius: 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); pointer-events: auto; 
    }
    .timer-bar { width: 100%; height: 8px; background: #eee; border-radius: 10px; margin-top: 10px; overflow: hidden; }
    #timer-fill { width: 100%; height: 100%; background: #eb4d4b; transition: width 0.1s linear; }

    #world { position: absolute; inset: 0; padding-top: 140px; }
    #pond { position: relative; width: 100%; height: 100%; }

    .leaf {
        position: absolute; width: 120px; height: 100px;
        background-size: contain; background-repeat: no-repeat; background-position: center;
        display: flex; align-items: center; justify-content: center;
        color: white; font-weight: bold; font-size: 18px; text-shadow: 1px 1px 2px black;
        cursor: pointer; transition: transform 0.2s;
    }
    .leaf:hover { transform: scale(1.1); }

    #frog {
        position: absolute; width: 80px; height: 80px;
        background-size: contain; background-repeat: no-repeat;
        z-index: 500; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        pointer-events: none; transform: translate(-50%, -60%);
        opacity: 0;
    }

    /* –ú–ï–•–ê–ù–ò–ö–ê –®–û–ö–ê (–ü–û –¢–í–û–ï–ú–£ –ó–ê–ü–†–û–°–£) */
    .shock { animation: shock-effect 0.1s infinite; }
    @keyframes shock-effect {
        0% { filter: brightness(3) hue-rotate(90deg); margin-left: -3px; }
        100% { filter: brightness(1); margin-left: 3px; }
    }

    #volume-ctrl { 
        position: absolute; top: 50px; right: 20px; background: white; 
        padding: 5px 10px; border-radius: 20px; display: flex; align-items: center; z-index: 1000; pointer-events: auto;
    }

    #overlay { 
        position: fixed; inset: 0; background: rgba(0,0,0,0.85); 
        display: none; flex-direction: column; justify-content: center; align-items: center; 
        color: white; z-index: 2000; 
    }
</style>
</head>
<body>

<div id="game-bg"></div>

<div id="ui-layer">
    <div id="header">FROGGY QUEST</div>
    <div id="lives-container"></div>
    <div id="question-box">
        <div id="q-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="timer-bar"><div id="timer-fill"></div></div>
    </div>
</div>

<div id="volume-ctrl">
    üîä <input type="range" id="vol-slider" min="0" max="1" step="0.1" value="0.5">
</div>

<div id="world">
    <div id="pond"><div id="frog"></div></div>
</div>

<div id="overlay">
    <h1 id="msg">–ö–û–ù–ï–¶ –ò–ì–†–´</h1>
    <button onclick="location.reload()" style="padding: 15px 30px; cursor: pointer; border-radius: 10px; border: none; background: var(--ui-bg); color: white;">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
</div>

<script>
let cfg = {
    t: "FROGGY QUEST", li: 5, tm: 15, tme: true,
    bg: "", fr: "", le: "", ic: "", vol: 0.5,
    s: [], qs: []
};

let currentQ = 0;
let lives = 5;
let timer;

// 1. –ß–ò–¢–ê–ï–ú –î–ê–ù–ù–´–ï –ò–ó –†–ï–î–ê–ö–¢–û–†–ê
function loadGame() {
    const urlParams = new URLSearchParams(window.location.search);
    const data = urlParams.get('d');
    if (data) {
        try {
            cfg = JSON.parse(decodeURIComponent(data));
        } catch(e) { console.error("Data error"); }
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤–∏–∑—É–∞–ª –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    document.getElementById('game-bg').style.backgroundImage = `url(${cfg.bg})`;
    document.getElementById('frog').style.backgroundImage = `url(${cfg.fr})`;
    document.getElementById('header').innerText = cfg.t;
    document.getElementById('vol-slider').value = cfg.vol;
    lives = cfg.li;
    
    updateLives();
    renderQuestion();
}

function updateLives() {
    const container = document.getElementById('lives-container');
    container.innerHTML = '';
    for(let i=0; i<lives; i++) {
        const heart = document.createElement('div');
        heart.className = 'life-icon';
        heart.style.backgroundImage = `url(${cfg.ic})`;
        container.appendChild(heart);
    }
}

// 2. –û–¢–†–ò–°–û–í–ö–ê –í–û–ü–†–û–°–ê
function renderQuestion() {
    if (currentQ >= cfg.qs.length) {
        finish("–ü–û–ë–ï–î–ê!", 3);
        return;
    }

    const qData = cfg.qs[currentQ];
    document.getElementById('q-text').innerText = qData.q;
    
    const pond = document.getElementById('pond');
    pond.querySelectorAll('.leaf').forEach(l => l.remove());

    // –°–æ–∑–¥–∞–µ–º 3 –ª–∏—Å—Ç–∞
    let answers = qData.o.map((text, i) => ({ text, correct: i === 0 }));
    answers = answers.filter(a => a.text !== "").sort(() => Math.random() - 0.5);

    answers.forEach((ans, i) => {
        const leaf = document.createElement('div');
        leaf.className = 'leaf';
        leaf.style.backgroundImage = `url(${cfg.le})`;
        leaf.innerText = ans.text;
        leaf.style.left = (15 + i * 35) + "%";
        leaf.style.top = "60%";
        
        leaf.onclick = () => handleChoice(ans.correct, leaf);
        pond.appendChild(leaf);

        if (currentQ === 0 && i === 0) {
            const f = document.getElementById('frog');
            f.style.opacity = 1;
            moveFrog(leaf);
        }
    });

    startTimer();
}

function handleChoice(correct, el) {
    if (correct) {
        playSound(1);
        moveFrog(el);
        currentQ++;
        setTimeout(renderQuestion, 600);
    } else {
        lives--;
        updateLives();
        playSound(2);
        
        // –≠–§–§–ï–ö–¢ –®–û–ö–ê
        const f = document.getElementById('frog');
        f.classList.add('shock');
        setTimeout(() => f.classList.remove('shock'), 600);

        if (lives <= 0) finish("–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê", 4);
    }
}

function moveFrog(target) {
    const f = document.getElementById('frog');
    f.style.left = (target.offsetLeft + target.offsetWidth/2) + "px";
    f.style.top = (target.offsetTop + target.offsetHeight/2) + "px";
}

function startTimer() {
    clearInterval(timer);
    if (!cfg.tme) return;
    let time = 100;
    timer = setInterval(() => {
        time -= (100 / (cfg.tm * 10));
        document.getElementById('timer-fill').style.width = time + "%";
        if (time <= 0) {
            clearInterval(timer);
            handleChoice(false, {offsetLeft: 0, offsetWidth: 0});
        }
    }, 100);
}

function playSound(idx) {
    if (cfg.s[idx]) {
        const a = new Audio(cfg.s[idx]);
        a.volume = document.getElementById('vol-slider').value;
        a.play().catch(e => {});
    }
}

function finish(txt, sndIdx) {
    clearInterval(timer);
    document.getElementById('msg').innerText = txt;
    document.getElementById('overlay').style.display = 'flex';
    playSound(sndIdx);
}

window.onload = loadGame;
</script>
</body>
</html>
