<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Froggy Jumps Quiz</title>
<style>
/* –¢–í–û–ò –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô */
:root { --water1: #2bbcd6; --water2: #168ea0; --ui-bg: #6ab04c; }
html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: Arial, sans-serif; background-color: #1e272e; }

#bg-container {
    position: fixed; inset: 0;
    background-repeat: no-repeat; background-position: center; background-size: cover;
    z-index: -1;
}

#ui-layer { position: absolute; top: 0; width: 100%; z-index: 1000; pointer-events: none; }
#header { background: var(--ui-bg); color: white; padding: 10px; text-align: center; font-weight: bold; pointer-events: auto; text-transform: uppercase; }
#lives-container { position: absolute; top: 50px; left: 20px; display: flex; gap: 8px; pointer-events: auto; }
.life-icon { width: 52px; height: 52px; background: no-repeat center / contain; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }

#question-box { background: white; width: 85%; max-width: 500px; margin: 10px auto; padding: 12px; border-radius: 18px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.25); pointer-events: auto; }
.timer-bar { width: 100%; height: 8px; background: #dfe6e9; border-radius: 5px; margin-top: 8px; overflow: hidden; }
#timer-fill { width: 100%; height: 100%; background: #eb4d4b; transition: width 0.1s linear; }

#world { position: absolute; inset: 0; padding-top: 60px; overflow: hidden; }
#pond { position: relative; width: 100%; height: 100%; margin: 0 auto; transition: transform 0.8s ease-in-out; }

.leaf {
    position: absolute; width: 22vw; height: 18vw; max-width: 180px; max-height: 150px;
    background: no-repeat center / contain; display: flex; align-items: center; justify-content: center;
    padding: 15px; box-sizing: border-box; text-align: center; font-size: 20px;
    color: white; font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
    cursor: pointer; transform: scale(1); transition: transform 0.4s;
}
.leaf.active { transform: scale(1.15); filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.9)); }

#frog {
    position: absolute; width: 12vw; height: 12vw; max-width: 100px; max-height: 100px;
    background: no-repeat center / contain; transform: translate(-50%, -65%) scale(1);
    z-index: 999; transition: left 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), top 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    pointer-events: none; opacity: 0;
}

.shock { animation: electric-shock 0.1s infinite; }
@keyframes electric-shock {
    0% { transform: translate(-50%, -65%) scale(1.1) rotate(2deg); filter: brightness(2) hue-rotate(180deg); }
    100% { transform: translate(-50%, -65%) scale(1.1) rotate(-2deg); filter: brightness(1); }
}

#overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; display: none; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; }
#countdown-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 3000; display: none; justify-content: center; align-items: center; font-size: 150px; color: white; font-weight: bold; }
#volume-control { position: absolute; top: 50px; right: 20px; background: rgba(255, 255, 255, 0.9); padding: 8px 15px; border-radius: 25px; display: flex; align-items: center; gap: 10px; z-index: 2000; pointer-events: auto; border: 2px solid var(--ui-bg); }
</style>
</head>
<body>

<div id="bg-container"></div>
<div id="countdown-overlay"></div>

<div id="ui-layer">
    <div id="header">FROGGY QUEST</div>
    <div id="lives-container"></div>
    <div id="question-box">
        <div id="q-text"><b>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</b></div>
        <div class="timer-bar"><div id="timer-fill"></div></div>
    </div>
</div>

<div id="volume-control">
    <span id="speaker-icon">üîä</span>
    <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.5">
</div>

<div id="world">
    <div id="pond"><div id="frog"></div></div>
</div>

<div id="overlay">
    <h1 id="msg">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h1>
    <button onclick="location.reload()" style="padding: 15px 45px; border-radius: 30px; border: none; background: #6ab04c; color: white; font-size: 18px; cursor: pointer;">–ü–û–ü–†–û–ë–û–í–ê–¢–¨ –°–ù–û–í–ê</button>
</div>

<script>
// --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø ---
let config = {
    t: "FROGGY QUEST", li: 5, tm: 15, tme: true,
    bg: "bg.png", fr: "2.png", le: "1.png", ic: "3.png", vol: 0.5,
    s: [], qs: []
};

let currentQ = 0;
let lives = 5;
let timerInt;
let isMoving = false;

// --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
function init() {
    const params = new URLSearchParams(window.location.search);
    const data = params.get('d');
    if (data) {
        try { config = JSON.parse(decodeURIComponent(data)); } catch(e) {}
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤–∏–∑—É–∞–ª
    document.getElementById('header').innerText = config.t;
    document.getElementById('bg-container').style.backgroundImage = `url(${config.bg})`;
    document.getElementById('frog').style.backgroundImage = `url(${config.fr})`;
    document.getElementById('volume-slider').value = config.vol;
    lives = config.li;
    
    updateLives();
    startStartCountdown();
}

function updateLives() {
    const container = document.getElementById('lives-container');
    container.innerHTML = '';
    for(let i=0; i<lives; i++) {
        const icon = document.createElement('div');
        icon.className = 'life-icon';
        icon.style.backgroundImage = `url(${config.ic})`;
        container.appendChild(icon);
    }
}

function startStartCountdown() {
    const over = document.getElementById('countdown-overlay');
    over.style.display = 'flex';
    let c = 3;
    playSound(0); // –ó–≤—É–∫ –æ—Ç—Å—á–µ—Ç–∞
    
    const itv = setInterval(() => {
        over.innerText = c > 0 ? c : "GO!";
        if (c < 0) {
            clearInterval(itv);
            over.style.display = 'none';
            document.getElementById('frog').style.opacity = 1;
            renderStep();
        }
        c--;
    }, 1000);
}

// --- –õ–û–ì–ò–ö–ê –®–ê–ì–û–í ---
function renderStep() {
    if (currentQ >= config.qs.length) {
        showEnd("–ü–û–ë–ï–î–ê!", 3); // –ó–≤—É–∫ –ø–æ–±–µ–¥—ã
        return;
    }

    isMoving = false;
    const q = config.qs[currentQ];
    document.getElementById('q-text').innerText = q.q;

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä—É–¥–∞ –æ—Ç —Å—Ç–∞—Ä—ã—Ö –ª–∏—Å—Ç—å–µ–≤
    const pond = document.getElementById('pond');
    pond.querySelectorAll('.leaf').forEach(l => l.remove());

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 3 –ª–∏—Å—Ç–∞ –≤ —Ä—è–¥
    let opts = q.o.map((text, i) => ({ text, correct: i === 0 }));
    opts = opts.filter(o => o.text !== "").sort(() => Math.random() - 0.5);

    opts.forEach((opt, i) => {
        const leaf = document.createElement('div');
        leaf.className = 'leaf active';
        leaf.style.backgroundImage = `url(${config.le})`;
        leaf.innerText = opt.text;
        
        // –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        leaf.style.left = (15 + i * 35) + "%";
        leaf.style.bottom = "20%"; // –õ–∏—Å—Ç—å—è –≤ –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∫–ª–∏–∫–∞
        
        leaf.onclick = () => checkAnswer(opt.correct, leaf);
        pond.appendChild(leaf);

        // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å, —Å–∞–∂–∞–µ–º –ª—è–≥—É—à–∫—É –Ω–∞ –ø–µ—Ä–≤—ã–π –ø–æ–ø–∞–≤—à–∏–π—Å—è –ª–∏—Å—Ç —Å—Ä–∞–∑—É
        if (currentQ === 0 && i === 0) {
            placeFrogOn(leaf);
        }
    });

    startTimer();
}

function checkAnswer(isCorrect, leafEl) {
    if (isMoving) return;
    clearInterval(timerInt);

    if (isCorrect) {
        isMoving = true;
        playSound(1); // –í—Å–ø–ª–µ—Å–∫
        placeFrogOn(leafEl);
        
        setTimeout(() => {
            currentQ++;
            // –ê–Ω–∏–º–∞—Ü–∏—è "–ø—Ä–æ–ø–ª—ã–≤–∞–Ω–∏—è" —É—Ä–æ–≤–Ω—è
            document.getElementById('pond').style.transform = "translateY(100vh)";
            setTimeout(() => {
                document.getElementById('pond').style.transition = "none";
                document.getElementById('pond').style.transform = "translateY(-100vh)";
                renderStep();
                setTimeout(() => {
                    document.getElementById('pond').style.transition = "transform 0.8s ease-in-out";
                    document.getElementById('pond').style.transform = "translateY(0)";
                }, 50);
            }, 400);
        }, 600);
    } else {
        lives--;
        updateLives();
        playSound(2); // –®–æ–∫
        const frog = document.getElementById('frog');
        frog.classList.add('shock');
        setTimeout(() => {
            frog.classList.remove('shock');
            if (lives <= 0) showEnd("–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê", 4);
            else startTimer();
        }, 1000);
    }
}

function placeFrogOn(el) {
    const f = document.getElementById('frog');
    const rect = el.getBoundingClientRect();
    const pondRect = document.getElementById('pond').getBoundingClientRect();
    
    f.style.left = (el.offsetLeft + el.offsetWidth / 2) + "px";
    f.style.top = (el.offsetTop + el.offsetHeight / 2) + "px";
}

function startTimer() {
    if (!config.tme) return;
    let val = 100;
    const fill = document.getElementById('timer-fill');
    timerInt = setInterval(() => {
        val -= (100 / (config.tm * 10));
        fill.style.width = val + "%";
        if (val <= 0) {
            clearInterval(timerInt);
            handleTimeout();
        }
    }, 100);
}

function handleTimeout() {
    lives--;
    updateLives();
    if (lives <= 0) showEnd("–í–†–ï–ú–Ø –í–´–®–õ–û", 4);
    else renderStep();
}

function playSound(idx) {
    if (config.s[idx]) {
        const a = new Audio(config.s[idx]);
        a.volume = document.getElementById('volume-slider').value;
        a.play().catch(() => {});
    }
}

function showEnd(t, sIdx) {
    document.getElementById('msg').innerText = t;
    document.getElementById('overlay').style.display = 'flex';
    playSound(sIdx);
}

window.onload = init;
</script>
</body>
</html>
