<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Froggy Quest</title>
    <style>
        :root { --ui-bg: #6ab04c; }
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; background: #000; }
        
        #game-bg { position: fixed; inset: 0; background-size: cover; background-position: center; z-index: -1; transition: opacity 0.5s; }
        #ui-layer { position: absolute; top: 0; width: 100%; z-index: 1000; pointer-events: none; }
        #header { background: var(--ui-bg); color: white; padding: 12px; text-align: center; font-weight: bold; pointer-events: auto; letter-spacing: 1px; }
        
        #lives-container { position: absolute; top: 60px; left: 20px; display: flex; gap: 8px; pointer-events: auto; }
        .life-icon { width: 40px; height: 40px; background-size: contain; background-repeat: no-repeat; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }

        #question-box { 
            background: white; width: 85%; max-width: 500px; margin: 15px auto; padding: 20px; 
            border-radius: 25px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.4); pointer-events: auto; 
        }
        #q-text { font-size: 20px; color: #2d3436; font-weight: 600; }
        .timer-bar { width: 100%; height: 10px; background: #eee; border-radius: 10px; margin-top: 15px; overflow: hidden; }
        #timer-fill { width: 100%; height: 100%; background: #eb4d4b; transition: width 0.1s linear; }

        #world { position: absolute; inset: 0; padding-top: 160px; display: flex; align-items: center; justify-content: center; }
        #pond { position: relative; width: 100%; height: 100%; }

        .leaf {
            position: absolute; width: 140px; height: 110px;
            background-size: contain; background-repeat: no-repeat; background-position: center;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            cursor: pointer; transition: transform 0.2s; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
        }
        .leaf:hover { transform: scale(1.1); }

        #frog {
            position: absolute; width: 90px; height: 90px;
            background-size: contain; background-repeat: no-repeat; background-position: center;
            z-index: 500; transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none; transform: translate(-50%, -70%); opacity: 0;
        }

        /* –ú–ï–•–ê–ù–ò–ö–ê –®–û–ö–ê */
        .shock { animation: shock-effect 0.1s infinite; }
        @keyframes shock-effect {
            0% { filter: brightness(3) hue-rotate(120deg); transform: translate(-50%, -70%) scale(1.2) rotate(3deg); }
            100% { filter: brightness(1); transform: translate(-50%, -70%) scale(1.2) rotate(-3deg); }
        }

        #volume-ctrl { position: absolute; top: 60px; right: 20px; background: rgba(255,255,255,0.9); padding: 5px 15px; border-radius: 30px; display: flex; align-items: center; gap: 10px; z-index: 1000; pointer-events: auto; border: 2px solid var(--ui-bg); }
        
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; flex-direction: column; justify-content: center; align-items: center; color: white; z-index: 2000; text-align: center; }
        #start-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 3000; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-bg"></div>

<div id="start-screen" onclick="startGame()">
    <h1 id="start-title">FROGGY QUEST</h1>
    <p>–ù–ê–ñ–ú–ò–¢–ï, –ß–¢–û–ë–´ –ù–ê–ß–ê–¢–¨</p>
</div>

<div id="ui-layer">
    <div id="header">–ó–ê–ì–†–£–ó–ö–ê...</div>
    <div id="lives-container"></div>
    <div id="question-box">
        <div id="q-text">–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å!</div>
        <div class="timer-bar"><div id="timer-fill"></div></div>
    </div>
</div>

<div id="volume-ctrl">
    üîä <input type="range" id="vol-slider" min="0" max="1" step="0.1" value="0.5">
</div>

<div id="world">
    <div id="pond"><div id="frog"></div></div>
</div>

<div id="overlay">
    <h1 id="msg">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h1>
    <button onclick="location.reload()" style="padding: 18px 40px; cursor: pointer; border-radius: 30px; border: none; background: #6ab04c; color: white; font-size: 20px; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
</div>

<script>
let cfg = { t: "QUEST", li: 5, tm: 15, tme: true, bg: "", fr: "", le: "", ic: "", vol: 0.5, s: [], qs: [] };
let currentQ = 0, lives = 5, timer;

function init() {
    const urlParams = new URLSearchParams(window.location.search);
    const data = urlParams.get('d');
    if (data) {
        try { cfg = JSON.parse(decodeURIComponent(data)); } catch(e) { console.error("Data error"); }
    }
    
    document.getElementById('game-bg').style.backgroundImage = `url(${cfg.bg})`;
    document.getElementById('frog').style.backgroundImage = `url(${cfg.fr})`;
    document.getElementById('header').innerText = cfg.t;
    document.getElementById('start-title').innerText = cfg.t;
    document.getElementById('vol-slider').value = cfg.vol;
    lives = parseInt(cfg.li);
    updateLives();
}

function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    playSound(0); // –ó–≤—É–∫ —Å—Ç–∞—Ä—Ç–∞
    document.getElementById('frog').style.opacity = 1;
    renderQuestion();
}

function updateLives() {
    const container = document.getElementById('lives-container');
    container.innerHTML = '';
    for(let i=0; i<lives; i++) {
        const heart = document.createElement('div');
        heart.className = 'life-icon';
        heart.style.backgroundImage = `url(${cfg.ic})`;
        container.appendChild(heart);
    }
}

function renderQuestion() {
    if (currentQ >= cfg.qs.length) {
        finish("–ü–û–ë–ï–î–ê!", 3); // –ü–æ–±–µ–¥–∞
        return;
    }

    const qData = cfg.qs[currentQ];
    document.getElementById('q-text').innerText = qData.q;
    document.getElementById('header').innerText = `${cfg.t} | ${currentQ + 1}/${cfg.qs.length}`;
    
    const pond = document.getElementById('pond');
    pond.querySelectorAll('.leaf').forEach(l => l.remove());

    let answers = qData.o.map((text, i) => ({ text, correct: i === 0 }));
    answers = answers.filter(a => a.text !== "").sort(() => Math.random() - 0.5);

    answers.forEach((ans, i) => {
        const leaf = document.createElement('div');
        leaf.className = 'leaf';
        leaf.style.backgroundImage = `url(${cfg.le})`;
        leaf.innerText = ans.text;
        leaf.style.left = (15 + i * 35) + "%";
        leaf.style.top = "60%";
        
        leaf.onclick = () => handleChoice(ans.correct, leaf);
        pond.appendChild(leaf);

        if (currentQ === 0 && i === 0) moveFrog(leaf);
    });
    startTimer();
}

function handleChoice(correct, el) {
    clearInterval(timer);
    if (correct) {
        playSound(1); // –í—Å–ø–ª–µ—Å–∫
        moveFrog(el);
        currentQ++;
        setTimeout(renderQuestion, 800);
    } else {
        lives--;
        updateLives();
        playSound(2); // –û—à–∏–±–∫–∞
        const f = document.getElementById('frog');
        f.classList.add('shock');
        setTimeout(() => {
            f.classList.remove('shock');
            if (lives <= 0) finish("–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê", 4); // –ü–æ—Ä–∞–∂–µ–Ω–∏–µ (4.mp3)
            else startTimer();
        }, 800);
    }
}

function moveFrog(target) {
    const f = document.getElementById('frog');
    f.style.left = (target.offsetLeft + target.offsetWidth/2) + "px";
    f.style.top = (target.offsetTop + target.offsetHeight/2) + "px";
}

function startTimer() {
    if (!cfg.tme) return;
    let time = 100;
    timer = setInterval(() => {
        time -= (100 / (cfg.tm * 10));
        document.getElementById('timer-fill').style.width = time + "%";
        if (time <= 0) {
            clearInterval(timer);
            handleChoice(false, null);
        }
    }, 100);
}

function playSound(idx) {
    if (cfg.s[idx]) {
        const a = new Audio(cfg.s[idx]);
        a.volume = document.getElementById('vol-slider').value;
        a.play().catch(e => {});
    }
}

function finish(txt, sndIdx) {
    document.getElementById('msg').innerText = txt;
    document.getElementById('overlay').style.display = 'flex';
    playSound(sndIdx);
}

window.onload = init;
</script>
</body>
</html>
