<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#000; font-family:sans-serif; }
        #gm { width:100%; height:100%; position:relative; background-size:cover; background-position:center; display:none; }
        #hd { padding:10px; color:#fff; text-align:center; font-weight:bold; box-shadow:0 2px 10px rgba(0,0,0,0.3); }
        #frog { width:80px; height:80px; position:absolute; z-index:100; background-size:contain; background-repeat:no-repeat; transition:0.6s cubic-bezier(.47,1.21,.58,1); }
        .leaf { position:absolute; width:150px; height:110px; background-size:contain; background-repeat:no-repeat; display:flex; align-items:center; justify-content:center; color:#fff; cursor:pointer; text-align:center; padding:15px; box-sizing:border-box; font-weight:bold; }
        .shock { animation: sk 0.1s infinite; filter: brightness(2) contrast(2) sepia(1) hue-rotate(140deg); }
        @keyframes sk { 0%, 100% { transform:scale(1); } 50% { transform:scale(1.1) rotate(5deg); } }
        #lives { position:absolute; top:60px; left:20px; display:flex; gap:5px; }
        .h { width:30px; height:30px; background-size:contain; background-repeat:no-repeat; }
        #tm-w { position:absolute; top:0; left:0; width:100%; height:6px; background:rgba(0,0,0,0.2); }
        #tm-f { height:100%; width:100%; background:#ff4757; transition:linear; }
    </style>
</head>
<body>
    <div id="gm">
        <div id="tm-w"><div id="tm-f"></div></div>
        <div id="hd"></div>
        <div id="lives"></div>
        <div id="pond"><div id="frog"></div></div>
    </div>
<script>
    let c, step=0, hp, last={x:50,y:85}, aud={}, tmr;
    const p = new URLSearchParams(window.location.search);
    const d = p.get('d');

    if(d) {
        try { c = JSON.parse(decodeURIComponent(d)); init(); } 
        catch(e) { document.body.innerHTML = "DATA ERROR"; }
    }

    function init(){
        const g=document.getElementById('gm'); g.style.display='block';
        g.style.backgroundImage=`url(${c.bg})`;
        const h=document.getElementById('hd'); h.innerText=c.t; h.style.backgroundColor=c.c1; h.style.fontSize=c.fs+'px';
        document.getElementById('frog').style.backgroundImage=`url(${c.fr})`;
        hp=c.li;
        c.s.forEach((u,i)=> { if(u) { aud[i]=new Audio(u); aud[i].volume=c.vol; } });
        updateHp(); pos(50,85); load();
    }

    function updateHp(){
        const b=document.getElementById('lives'); b.innerHTML='';
        for(let i=0; i<hp; i++) b.innerHTML+=`<div class="h" style="background-image:url(${c.ic})"></div>`;
    }

    function load(){
        if(step >= c.qs.length) { alert(c.win); return; }
        clearInterval(tmr);
        const q=c.qs[step];
        const pond=document.getElementById('pond'); pond.querySelectorAll('.leaf').forEach(l=>l.remove());
        
        q.o.forEach((t,i)=>{
            const l=document.createElement('div'); l.className='leaf';
            l.style.backgroundImage=`url(${c.le})`;
            l.style.left=(15+i*35)+'%'; l.style.top=(65-(step%c.qp)*8)+'%';
            l.style.fontSize=(c.fs-4)+'px'; l.innerText=t;
            l.onclick=()=>jump(i, 15+i*35, 65-(step%c.qp)*8);
            pond.appendChild(l);
        });
        if(c.tme) startTmr();
    }

    function jump(i,x,y){
        pos(x,y);
        if(i===0){ 
            if(aud[1]) aud[1].play(); 
            last={x,y}; step++; setTimeout(load, 600); 
        } else {
            if(aud[2]) aud[2].play(); 
            const f=document.getElementById('frog'); f.classList.add('shock'); hp--; updateHp();
            setTimeout(()=>{
                f.classList.remove('shock'); pos(last.x, last.y);
                if(hp<=0) { alert(c.lose); location.reload(); }
            }, 800);
        }
    }

    function startTmr(){
        let w=100; const f=document.getElementById('tm-f');
        tmr=setInterval(()=>{
            w-=100/(c.tm*10); f.style.width=w+'%';
            if(w<=0){ clearInterval(tmr); alert(c.lose); location.reload(); }
        }, 100);
    }

    function pos(x,y){
        const f=document.getElementById('frog');
        f.style.left=`calc(${x}% - 40px)`; f.style.top=`calc(${y}% - 40px)`;
    }
</script>
</body>
</html>
