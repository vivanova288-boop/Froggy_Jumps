<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Master Quest Builder v3</title>
    <style>
        :root { --accent: #2ecc71; --bg: #1a1a1a; --card: #2d2d2d; }
        body { margin: 0; display: flex; height: 100vh; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #eee; }
        #sidebar { width: 450px; background: #111; padding: 20px; overflow-y: auto; border-right: 2px solid var(--accent); }
        .block { background: var(--card); padding: 15px; margin-bottom: 15px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        h2 { color: var(--accent); margin-top: 0; font-size: 18px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        label { display: block; font-size: 12px; margin: 10px 0 5px; color: #bbb; }
        input, textarea { width: 100%; padding: 10px; background: #111; border: 1px solid #444; color: #fff; border-radius: 5px; box-sizing: border-box; }
        textarea { height: 80px; font-family: monospace; }
        .sound-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-gen { background: var(--accent); color: #000; border: none; width: 100%; padding: 20px; font-weight: bold; cursor: pointer; border-radius: 8px; font-size: 16px; transition: 0.3s; margin-top: 10px; }
        .btn-gen:hover { background: #27ae60; box-shadow: 0 0 20px rgba(46, 204, 113, 0.4); }
        #preview { flex: 1; background: #000; display: flex; flex-direction: column; }
        iframe { flex: 1; border: none; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2>КОНСТРУКТОР КВЕСТА</h2>
    
    <div class="block">
        <label>Заголовок (верхняя плашка)</label>
        <input type="text" id="v-title" value="PAST SIMPLE CHALLENGE" oninput="update()">
        <label>Вопросы (Вопрос|Верный|Ложный|Ложный)</label>
        <textarea id="v-questions" oninput="update()">I ___ a movie.|watched|watch|watches
She ___ to school.|went|go|goes
They ___ happy.|were|was|are</textarea>
    </div>

    <div class="block">
        <label>ГРАФИКА (PNG)</label>
        <label>Лягушка/Герой:</label><input type="file" onchange="encode('frog', this)">
        <label>Лилия/Платформа:</label><input type="file" onchange="encode('leaf', this)">
        <label>Фон:</label><input type="file" onchange="encode('bg', this)">
        <label>Жизнь:</label><input type="file" onchange="encode('life', this)">
    </div>

    <div class="block">
        <label>АУДИО (7 ЗВУКОВ)</label>
        <div class="sound-grid">
            <div><label>1. Всплеск:</label><input type="file" onchange="aud('s1', this)"></div>
            <div><label>2. Шок:</label><input type="file" onchange="aud('s2', this)"></div>
            <div><label>3. Победа:</label><input type="file" onchange="aud('s3', this)"></div>
            <div><label>4. Финал (4.mp3):</label><input type="file" onchange="aud('s4', this)"></div>
            <div><label>5. Старт:</label><input type="file" onchange="aud('s5', this)"></div>
            <div><label>6. Уровень:</label><input type="file" onchange="aud('s6', this)"></div>
            <div><label>7. Отсчет:</label><input type="file" onchange="aud('s7', this)"></div>
        </div>
    </div>

    <button class="btn-gen" onclick="copyIframe()">СКОПИРОВАТЬ КОД ДЛЯ GENIALLY</button>
</div>

<div id="preview">
    <iframe id="target"></iframe>
</div>

<script>
    let imgs = { frog:'', leaf:'', bg:'', life:'' };
    let sounds = { s1:'', s2:'', s3:'', s4:'', s5:'', s6:'', s7:'' };

    function encode(k, i) { 
        const r = new FileReader(); 
        r.onload = (e) => { imgs[k] = e.target.result; update(); }; 
        r.readAsDataURL(i.files[0]); 
    }
    function aud(k, i) { 
        const r = new FileReader(); 
        r.onload = (e) => { sounds[k] = e.target.result; update(); }; 
        r.readAsDataURL(i.files[0]); 
    }

    function update() {
        const title = document.getElementById('v-title').value;
        const qRaw = document.getElementById('v-questions').value.split('\n').filter(l => l.includes('|'));
        const qJson = qRaw.map(l => {
            const p = l.split('|');
            const opts = [p[1], p[2], p[3]].sort(() => Math.random() - 0.5);
            return { q: p[0], options: opts, correct: opts.indexOf(p[1]) };
        });

        const doc = `
<!DOCTYPE html>
<html>
<head>
    <style>
        body { margin:0; background:url(${imgs.bg}) center/cover fixed; font-family:sans-serif; overflow:hidden; }
        #header { background:rgba(0,0,0,0.8); color:#2ecc71; padding:10px; text-align:center; font-size:20px; border-bottom:2px solid #2ecc71; }
        #q-box { background:#fff; width:90%; margin:10px auto; padding:15px; border-radius:10px; text-align:center; color:#333; font-weight:bold; }
        .leaf { position:absolute; width:120px; height:80px; background:url(${imgs.leaf}) no-repeat center/contain; display:flex; align-items:center; justify-content:center; color:#fff; font-size:14px; cursor:pointer; }
        #frog { position:absolute; width:70px; height:70px; background:url(${imgs.frog}) no-repeat center/contain; transform:translate(-50%,-50%); z-index:100; transition: 0.5s; }
        .shock { animation: shake 0.1s infinite; filter: brightness(2) hue-rotate(90deg); }
        @keyframes shake { 0%{left:calc(var(--x) - 5px)} 100%{left:calc(var(--x) + 5px)} }
    </style>
</head>
<body>
    <div id="header">${title}</div>
    <div id="q-box">Загрузка...</div>
    <div id="pond" style="height:80vh; position:relative;">
        <div id="frog"></div>
    </div>
    <script>
        const questions = ${JSON.stringify(qJson)};
        const s = { 
            splash: new Audio("${sounds.s1}"), shock: new Audio("${sounds.s2}"), 
            win: new Audio("${sounds.s3}"), fail: new Audio("${sounds.s4}"), 
            start: new Audio("${sounds.s5}"), lv: new Audio("${sounds.s6}"), tick: new Audio("${sounds.s7}") 
        };
        // Логика игры (прыжки, шок, отскок назад)
        let step = 0;
        // ... (код движка)
    <\/script>
</body>
</html>`;
        document.getElementById('target').srcdoc = doc;
    }

    function copyIframe() {
        const code = `<iframe srcdoc='${document.getElementById('target').srcdoc.replace(/'/g, "&apos;")}' width="100%" height="600px" frameborder="0"></iframe>`;
        navigator.clipboard.writeText(code);
        alert("КОД СКОПИРОВАН! В Genially выбери: Вставить -> Другое (Others)");
    }
</script>
</body>
</html>
