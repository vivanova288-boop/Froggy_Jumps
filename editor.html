<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Froggy Quest Builder - Genially Edition</title>
    <style>
        :root { --accent: #2ecc71; --dark-bg: #1a1a1d; --panel: #252529; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', sans-serif; background: var(--dark-bg); color: #fff; display: flex; }
        
        /* Панель управления */
        #controls { width: 450px; background: var(--panel); border-right: 2px solid #000; display: flex; flex-direction: column; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        h2 { color: var(--accent); font-size: 18px; margin-top: 0; text-transform: uppercase; border-bottom: 1px solid #444; padding-bottom: 10px; }
        
        .section { margin-bottom: 25px; background: #2d2d33; padding: 15px; border-radius: 8px; }
        .section h3 { font-size: 12px; color: #888; margin-top: 0; text-transform: uppercase; margin-bottom: 15px; }
        
        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 11px; color: #aaa; margin-bottom: 5px; }
        input[type="text"], input[type="number"], textarea, select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 4px; box-sizing: border-box; }
        .row { display: flex; gap: 10px; }
        
        /* Кнопка */
        .btn-gen { background: #e74c3c; color: #fff; border: none; padding: 18px; width: 100%; font-weight: bold; cursor: pointer; border-radius: 5px; transition: 0.3s; margin-top: 20px; }
        .btn-gen:hover { background: #ff5e4d; transform: scale(1.02); }

        /* Превью */
        #preview-zone { flex-grow: 1; display: flex; flex-direction: column; background: #111; position: relative; }
        #preview-label { background: #000; padding: 10px; text-align: center; font-size: 12px; color: #555; }
        #game-frame { flex-grow: 1; border: none; width: 100%; height: 100%; background: #000; }
    </style>
</head>
<body>

<div id="controls">
    <h2>МАСТЕРСКАЯ КВЕСТОВ</h2>

    <div class="section">
        <h3>1. Герой и Механика</h3>
        <div class="input-group">
            <label>Персонаж (Файл)</label>
            <input type="file" id="hero-img" onchange="updateAsset('hero', this)">
        </div>
        <div class="row">
            <div class="input-group">
                <label>Размер (%)</label>
                <input type="number" id="hero-size" value="100" oninput="liveRefresh()">
            </div>
            <div class="input-group">
                <label>Скорость (сек)</label>
                <input type="number" id="hero-speed" value="0.3" step="0.1" oninput="liveRefresh()">
            </div>
        </div>
        <div class="input-group">
            <label>
                <input type="checkbox" id="hero-glow" onchange="liveRefresh()"> Добавить свечение
            </label>
        </div>
    </div>

    <div class="section">
        <h3>2. Визуал и Эффекты</h3>
        <div class="row">
            <div class="input-group">
                <label>Цвет заголовка</label>
                <input type="color" id="color-title" value="#2ecc71" oninput="liveRefresh()">
            </div>
            <div class="input-group">
                <label>Цвет рамки</label>
                <input type="color" id="color-border" value="#1da85a" oninput="liveRefresh()">
            </div>
        </div>
        <div class="input-group">
            <label>Фон (Файл)</label>
            <input type="file" onchange="updateAsset('bg', this)">
        </div>
        <div class="input-group">
            <label>Эффект частиц</label>
            <select id="effect-type" onchange="liveRefresh()">
                <option value="none">Нет</option>
                <option value="snow">Снег (Particles)</option>
                <option value="stars">Звезды</option>
            </select>
        </div>
    </div>

    <div class="section">
        <h3>3. Вопросы</h3>
        <textarea id="questions" rows="5" oninput="liveRefresh()">2+2?|4|5|6
Как зовут героя?|Босс|Миньон|Крот</textarea>
    </div>

    <div class="section">
        <h3>4. Звуки (7 шт)</h3>
        <input type="file" accept="audio/*" onchange="updateAudio(1, this)"><label>1. Старт</label>
        <input type="file" accept="audio/*" onchange="updateAudio(2, this)"><label>2. Прыжок</label>
        <input type="file" accept="audio/*" onchange="updateAudio(3, this)"><label>3. Шок</label>
        <input type="file" accept="audio/*" onchange="updateAudio(4, this)"><label>4. Финал (4.mp3)</label>
        </div>

    <button class="btn-gen" onclick="copyIframe()">СКОПИРОВАТЬ IFRAME ДЛЯ GENIALLY</button>
</div>

<div id="preview-zone">
    <div id="preview-label">ПРЕДПРОСМОТР В РЕАЛЬНОМ ВРЕМЕНИ</div>
    <iframe id="game-frame"></iframe>
</div>

<script>
    let assets = { hero: '', bg: '', leaf: '' };
    let sounds = {};

    function updateAsset(type, input) {
        const reader = new FileReader();
        reader.onload = (e) => { assets[type] = e.target.result; liveRefresh(); };
        reader.readAsDataURL(input.files[0]);
    }

    function updateAudio(id, input) {
        const reader = new FileReader();
        reader.onload = (e) => { sounds['s'+id] = e.target.result; };
        reader.readAsDataURL(input.files[0]);
    }

    function liveRefresh() {
        const frame = document.getElementById('game-frame');
        const config = {
            titleColor: document.getElementById('color-title').value,
            borderColor: document.getElementById('color-border').value,
            heroSize: document.getElementById('hero-size').value,
            speed: document.getElementById('hero-speed').value,
            glow: document.getElementById('hero-glow').checked,
            questions: document.getElementById('questions').value.split('\n'),
            effect: document.getElementById('effect-type').value,
            assets: assets
        };

        // Генерируем HTML код для вставки в iframe
        const doc = `
            <html>
            <body style="margin:0; background:#000; color:white; font-family:sans-serif; overflow:hidden;">
                <div id="header" style="background:${config.titleColor}; border-bottom:5px solid ${config.borderColor}; padding:10px; text-align:center;">QUEST</div>
                <div id="game-area" style="height:100vh; background:url(${config.assets.bg}) center/cover;">
                    <div id="hero" style="
                        position:absolute; bottom:20%; left:50%; transform:translateX(-50%);
                        width:${config.heroSize}px; height:${config.heroSize}px;
                        background:url(${config.assets.hero}) no-repeat center/contain;
                        transition:${config.speed}s;
                        ${config.glow ? 'filter: drop-shadow(0 0 15px white);' : ''}
                    "></div>
                </div>
            </body>
            </html>
        `;
        frame.srcdoc = doc;
    }

    function copyIframe() {
        const code = `<iframe srcdoc='${document.getElementById('game-frame').srcdoc}' width="800" height="600" frameborder="0"></iframe>`;
        navigator.clipboard.writeText(code);
        alert("Код iFrame скопирован! Вставляй в Genially через Insert -> Others");
    }
</script>
</body>
</html>
